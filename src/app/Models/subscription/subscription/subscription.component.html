<div class="head">
  <div class="back-icon" (click)="goBack()">
    <i class="fas fa-chevron-left"></i>
</div>


</div>

    <div class="Carousel">
      <ngb-carousel *ngIf="images && images.length > 0">
        <ng-template ngbSlide *ngFor="let image of images">
          <div class="logo">
            <img [src]="image"  />

            <button class="side-button">20% off</button>

            <div class="whatsapp-container">
              <button class="whatsapp" (click)="shareOnWhatsApp()">
                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
              </button>
            </div>
            

          </div>
        </ng-template>
      </ngb-carousel>
    </div>
  
    <div class="main">

      <div class="details">
        <div class="tales">
          <h6>Cow Milk</h6>
          <p>450 ml</p>
        </div>
        <div class="tail">
          <p>Hormone Free</p>
        </div>
      </div>
  
      <div class="mid">
        <div class="add">
            <p><strong style="font-size: 14px;">₹{{ totalPrice }}</strong> <span> ₹45.50</span></p>
        </div>
        
        <div class="Cart" *ngIf="quantity > 0; else addTemplate">
          <button (click)="decreaseValue()">-</button>
          <span>{{ quantity }}</span>
          <button (click)="increaseValue()">+</button>
        </div>
        
        <ng-template #addTemplate>
          <button class="add-button" (click)="addQuantity()">Add</button>
        </ng-template>
     

      </div>

      <div class="offer-card">
        <div class="offer-details">
          <p>You are saving <span style="color: #04B56C;">$18.55</span> (20% OFF) with <span style="color: #04B56C;">VIP</span></p>
        </div>
      </div>
      <div class="grey-card">
        <p>Offer applicable on max 2 units.</p>
      </div>
      <div class="dotted-card">
        <div class="dot-card-details">
          <img src="https://cdn-icons-png.freepik.com/512/3960/3960581.png?ga=GA1.1.1335550155.1713184366" alt="Icon">
          <div class="text-details">
            <span>Order for 5 Days, get next 5 Days Free</span>
          </div>
          <p class="saved-amount">Know More</p>
        </div>
      </div>
      

      <div class="subscript">
        <div class="script">
          <div class="row">
            <div class="subscription-type">
              <h2>Subscription type</h2>
              <div class="sub-type">
                <div class="typed" [ngClass]="{'edit-mode': isSubscriptionTypesVisible}">
                  <div class="subscription-cards" *ngIf="isSubscriptionTypesVisible">
                    <p *ngFor="let subscription of subscriptionData" (click)="selectSubscription(subscription.subscription_type)">
                      {{ subscription.subscription_type }}
                    </p>
                    <!-- <button (click)="onPostSubscription()">Post Subscription Data</button> -->
                  </div>
                  
                               
                  <p *ngIf="!isSubscriptionTypesVisible" (click)="toggleSubscriptionTypes()">{{ selectedSubscription }}</p>
                  <div class="edit" *ngIf="!isSubscriptionTypesVisible">
                    <i class="fas fa-edit" (click)="toggleSubscriptionTypes()"></i>
                  </div>
                </div>
              </div>
            </div>
    
    
            <div class="start-date" *ngIf="selectedSubscription && !isSubscriptionTypesVisible">
              <h2>Start Date</h2>
              <form [formGroup]="form">
                <div class="forms-field">
                  <p>{{ defaultDate | date }}</p>
                  <input matInput [matDatepicker]="picker" formControlName="selectedDate"
                    [matDatepickerFilter]="dateFilter">
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker [dateClass]="dateClass"></mat-datepicker>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    
    
    
    <div class="descript">
        <h6><strong>Product Description</strong></h6>     
         <ul>
                <li>A glass of milk may become your kid's favourite drink with Country Delight Cow Milk.</li>
                <li>The natural sweetness of our cow's milk is the hallmark of purity and becomes an instant favourite among kids.</li>
                <li>Moreover, we source our milk from a mix of Desi Gir cows, desi Sahiwal cows, crossbred Holstein & Jersey cows.</li>
                <li> No preservatives, no milk powder or cream is added to the milk and the milk is not recombined in any form.</li>
                <li> We deliver the milk under the best cold chain right up to your doorstep..</li>

            </ul>
            </div>

          
            
            <div class="subscription">
              <ng-container *ngIf="!isEditing; else editingTemplate">
                <button class="add-sub" (click)="confirmSubscription()" [disabled]="quantity < 1">
                  <span>₹{{ totalPrice }} </span> Confirm Subscription
                </button>
              </ng-container>
              <ng-template #editingTemplate>
                <div class="subscription edit-mode">
                  <button class="resume-sub" (click)="resumeSubscription($event)">Resume Subscription</button>
                  <button class="cancel-sub" (click)="cancelSubscription()">Cancel Subscription</button>
                </div>
              </ng-template>
            </div>
            

            <div *ngIf=" showResumePopup" class="modal-overlay" (click)="closeResumePopup()">
              <div class="modal-content" (click)="$event.stopPropagation()">
                <h6>Subscription Resumed</h6>
                <p class="sub-label">Your subscription of cow milk has been resumed</p>
                <div class="divider">
                  </div>
                  <p class="awesome-button" (click)="closeResumePopup()">Awesome!</p>
                    
               </div>
            </div>
        <div *ngIf="showCancelPopup" class="modal-overlay" (click)="closeCancelPopup()">
          <div class="modal-content" (click)="$event.stopPropagation()">

            <h6>Cancel Subscription</h6>
            <p class="sub-label">If you are cancelling for a certain period of time you can pause the 
              subscription rather than cancelling.</p>
        <div class="popup-products-card">
            <div class="popup-img">
              <img src="https://cdnasd.countrydelight.in/New_product_image/CM_1646845937535_1665058250996.png">
            </div>
            
              <div class="para">
                <p>Cow Milk</p>
              <p class="sub-label">450 ml</p>
              </div>
              <p class="sub-item">₹36</p>
            </div>
            <div class="button-divider">
              <button class="pause-sub-button"  (click)="pauseSubscription()">Pause Subscription</button>
              <button class="cancel-sub-button" (click)="confirmCancelSubscription()">Cancel Subscription</button>
            </div>
          </div>
        </div>
        
        <!-- Popup for cancellation -->
        <div *ngIf="showCancellationPopup" class="modal-overlay" (click)="closeCancellationPopup()">
          <div class="modal-content" (click)="$event.stopPropagation()">
            <h6>Subscription Cancelled</h6>
            <p class="sub-label">Your subscription has been cancelled.</p>
              <button class="confirm-button" (click)="closeCancellationPopup()">Okay</button>
            
          </div>
        </div>

        <!-- Pause subscription popup -->
<div *ngIf="showPausePopup" class="modal-overlay" (click)="closePausePopup()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h6>Pause Subscription</h6>
    <p class="sub-label">If you are cancelling for a certain period of time you can pause the subscription rather than cancelling.</p>
    <div class="subscription-item">
      <img src="https://cdnasd.countrydelight.in/New_product_image/CM_1646845937535_1665058250996.png">
      <div class="subscription-details">
        <p>Cow Milk</p>
        <p class="sub-label">450 ml</p>
      </div>
      <p class="sub-item">₹36 <span class="original-price">₹45.50</span></p>
    </div>
    <p class="sub-label"><span>Select Duration</span></p>
    <div class="selection">

      <div class="option">
        <input type="radio" id="1day" name="duration" value="1day" (change)="onOptionChange($event)">
        <div class="lab-info">
          <label for="1day">For Next 1 Day</label>
        <p class="sub-label">Starting from Today</p>
        </div>
      </div>
      
      <div class="option">
        <input type="radio" id="7days" name="duration" value="7days" (change)="onOptionChange($event)">
        <div class="lab-info">
          <label for="7days">For Next 7 Days</label>
          <p class="sub-label">Starting from Today</p>
        </div>
      </div>
      
      <div class="option">
        <input type="radio" id="custom" name="duration" value="custom" (change)="onOptionChange($event); openModal()">
        <label for="custom">Custom Dates</label>
      </div>
      
      <div class="modal-overlay" *ngIf="showModal">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <h6>Pause Subscription</h6>
          <div class="date-picker">
            <div>
              <label for="startDate">Start Date</label>
              <div>{{ selectedStartDate ? (selectedStartDate | date: 'dd MMM yyyy') : 'Select Start Date' }}</div>
            </div>
            <div>
              <label for="endDate">End Date</label>
              <div>{{ selectedEndDate ? (selectedEndDate | date: 'dd MMM yyyy') : 'Select End Date' }}</div>
            </div>
          </div>
          
          <div class="calendar-container">
            <div class="calendar-header">
              <button (click)="previousMonth()" class="angled-btn">&lt;</button>
              <span>{{ currentMonth | date: 'MMMM yyyy' }}</span>
              <button (click)="nextMonth()" class="angled-btn">&gt;</button>
            </div>
            <div class="calendar">
              <div class="header" *ngFor="let day of days">{{ day }}</div>
              <div class="day" *ngFor="let date of calendarDates" 
                   [class.selected]="isDateSelected(date)" 
                   (click)="selectDate(date)">
                {{ date.getDate() }}
              </div>
            </div>
          </div>
      
          <button class="btn btn-primary" (click)="handleDatesSelection()" [disabled]="!areDatesSelected()">
            Confirm Date & Pause
          </button>

          <!-- <button class="btn btn-secondary" (click)="closeModal()">Cancel</button> -->
        </div>
      </div>
      
      
    </div>
    
    <div class="button-divider-confirm">
      <button class="confirm-button" (click)="confirmPause()" [disabled]="!isDurationSelected()">
        Confirm
      </button>
  </div>
</div>

<!-- Pause duration confirmation popup -->
<div *ngIf="showPausedDurationPopup" class="modal-overlay" (click)="closePausedDurationPopup()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h6>Subscription Paused</h6>
    <p class="sub-label">Your subscription has been paused for the selected duration.</p>
    <div class="button-divider">
      <p class="awesome-button" (click)="closePausedDurationPopup()">Awesome!</p>

    </div>
  </div>
</div>
  
  
  
   </div>

  <!-- </div> -->